%
%	Praxisbezug
%

\pagebreak
\section{NIS2 Analysis}

\onehalfspacing

\subsection{Findings from the Kubernetes CIS Benchmarks}

Let's inspect the detailed results from the CIS Scans:

% Table generated by Excel2LaTeX from sheet 'LaTeX'
\begin{table}[h]
  \centering
  \caption{CIS Scans Results RKE2 (Excel2LaTeX)}
    \begin{tabular}{| l | l | p{11.6cm} |}
    \hline
    ID & State & Description \\
    \hline\hline
    1.1.1 & Fail  & Ensure that the API server pod specification file permissions are set to 600 or more restrictive \\
    \hline
    1.1.3 & Fail  & Ensure that the controller manager pod specification file permissions are set to 600 or more restrictive \\
    \hline
    1.1.5 & Fail  & Ensure that the scheduler pod specification file permissions are set to 600 or more restrictive \\
    \hline
    1.1.7 & Fail  & Ensure that the etcd pod specification file permissions are set to 600 or more restrictive \\
    \hline
    1.2.17 & Fail  & Ensure that the --audit-log-path argument is set \\
    \hline
    1.2.18 & Fail  & Ensure that the --audit-log-maxage argument is set to 30 or as appropriate \\
    \hline
    1.2.19 & Fail  & Ensure that the --audit-log-maxbackup argument is set to 10 or as appropriate \\
    \hline
    3.2.1 & Fail  & Ensure that a minimal audit policy is created \\
    \hline
    1.1.9 & Warn  & Ensure that the Container Network Interface file permissions are set to 600 or more restrictive \\
    \hline
    1.1.20 & Warn  & Ensure that the Kubernetes PKI certificate file permissions are set to 600 or more restrictive \\
    \hline
    1.2.1 & Warn  & Ensure that the --anonymous-auth argument is set to false \\
    \hline
    ... & & \\
    \hline
    \end{tabular}%
  \label{tab:rke2Scan}%
\end{table}%

On RKE2, we can see several failed tests that we will inspect more closely.

The detailed results from AKS are more optimistic:
\pagebreak

% Table generated by Excel2LaTeX from sheet 'LaTeX'
\begin{table}[hp]
  \centering
  \caption{CIS Scans Results AKS (Excel2LaTeX)}
    \begin{tabular}{| l | l | p{11.6cm} |}
    \hline
    ID & State & Description \\
    \hline\hline
    3.1.1 & Warn  & Ensure that the kubeconfig file permissions are set to 644 or more restrictive \\
    \hline
    3.1.2 & Warn  & Ensure that the kubelet kubeconfig file ownership is set to root:root \\
    \hline
    3.1.3 & Warn  & Ensure that the kubelet configuration file has permissions set to 644 or more restrictive \\
    \hline
    3.1.4 & Warn  & Ensure that the kubelet configuration file ownership is set to root:root \\
    \hline
    3.2.11 & Warn  & Ensure that the RotateKubeletServerCertificate argument is set to true \\
    \hline
    3.2.1 & Pass  & Ensure that the --anonymous-auth argument is set to false \\
    \hline
    3.2.2 & Pass  & Ensure that the --authorization-mode argument is not set to AlwaysAllow \\
    \hline
    3.2.3 & Pass  & Ensure that the --client-ca-file argument is set as appropriate \\
    \hline
    3.2.4 & Pass  & Ensure that the --read-only-port argument is set to 0 \\
    \hline
    3.2.5 & Pass  & Ensure that the --streaming-connection-idle-timeout argument is not set to 0 \\
    \hline
    3.2.6 & Pass  & Ensure that the --protect-kernel-defaults argument is set to true \\
    \hline
    3.2.7 & Pass  & Ensure that the --make-iptables-util-chains argument is set to true \\
    \hline
    3.2.8 & Pass  & Ensure that the --hostname-override argument is not set \\
    \hline
    3.2.9 & Pass  & Ensure that the --event-qps argument is set to 0 or a level which ensures appropriate event capture \\
    \hline
    3.2.10 & Pass  & Ensure that the --rotate-certificates argument is not set to false \\
    \hline
    \end{tabular}%
  \label{tab:aksScan}%
\end{table}%

As we have seen before, benchmark test 3.2.1 for anonymous access to the Kubelet server is set to pass for the hosted Kubernetes version and is shown as a warning for the default installation of our RKE2 cluster. To support this test, the CIS Benchmark documentation states the obvious: "You should rely on authentication to authorize access and disallow anonymous requests."\footnote{\textit{CIS (2023)}: CIS AKS Benchmark, 3.2 Kubelet. \cite{cisAks}}

\subsection{Relevance for NIS2 Article 21}

The failing benchmark tests on our manually installed cluster are in benchmark sections 1.1—Control Plane Node Configuration Files, 1.2—API Server, and 3.2—Logging.

For the configuration file access permissions, the Benchmark documentation states: "You should restrict its file permissions to maintain the file's integrity. The file should be writable by only the administrators on the system."\footnote{\textit{CIS (2023)}: CIS Kubernetes Benchmark, 1.1 Control Plane Node Configuration Files. \cite{cisK8s}} In the field of computer security, this is referred to as the Principle of Least Privilege. For configuration file access, it means that they should only be readable and writeable by their owner (file permissions 0600).

For the logging configuration, the benchmark recommends enabling audit logging for the Kubernetes control plane, at least with a minimal audit policy. Its rationale is: "Logging is an important detective control for all systems to detect potential unauthorized access."\footnote{\textit{CIS (2023)}: Ibid., 3.2 Logging. \cite{cisK8s}} Logging, especially when the data is stored on a separate system, is crucial for problem-solving, detecting attacks, and performing a forensic analysis after an attack or breach.

The appropriate audit-log parameters need to be set to enable basic audit logging.\footnote{See \textit{CIS (2023)}: Ibid., 1.2 API Server. \cite{cisK8s}}

Restricting access to critical configuration files and enabling audit logging is part of basic cyber hygiene. It should be standard for all critical IT systems that follow established principles for good governance.

\subsection{Improving Compliance and mitigating the risks of attacks}

For the RKE2 installation, we can use the RKE2 hardening guide to enable full CIS Benchmark compliance. By specifying a CIS profile, the Kubernetes installation will be modified from its default to fulfill the CIS Benchmark and support CIS and NIS2 compliance.\footnote{See \textit{SUSE (2024)}: CIS Hardening Guide. \cite{rke2Hardening}}

Once the profile is selected, SUSE self-certifies RKE2 as CIS Benchmark compliant.\footnote{See \textit{SUSE (2024)}: CIS Self-Assessment Guide. \cite{rke2Self}}

Other Kubernetes distributions, such as Red Hat's OpenShift, also offer CIS compliance. 

We have already seen Microsoft's Azure Kubernetes Engine pass the CIS Benchmark. The other major hosted versions of Kubernetes, Google's Kubernetes Engine (GKE) and Amazon's Elastic Kubernetes Service (EKS), also offer CIS Compliance to their customers.

Ensuring that an IT system, such as a Kubernetes cluster, scores a passing grade on the CIS Benchmarks supports basic cyber hygiene and should be part of the IT Security Policy.

\subsection{NIS2 Article 21 Compliance}
